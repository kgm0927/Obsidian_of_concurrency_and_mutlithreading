

분산 컴퓨팅은 처음부터 멀티스레딩의 한 응용 분야였다. 모든 개인 컴퓨터가 단지 하나의 코어를 가진 단인 프로세스만 장착한 시절에도 정부와 연구소, 몇몇 기업들은 클러스터 형식의 멀티프로세서 시스템을 가졌었다. 이들 시스템은 멀티스레드 처리가 가능했다. 태스크를 프로세서에 걸쳐 분할해 시뮬레이션과 CGI 영화의 렌더링 같은 다양한 작업 속도를 개선시킬 수 있었다.

요즘은 거의 모든 데스크톱 수준 이상의 시스템은 하나 이상의 프로세서 코어를 가지며 저렴한 이더넷 연결을 사용해 여러 시스템을 하나의 클러스터로 구성하는 것은 손쉬운 일이 됐다. OpenMP와 MPI 같은 프레임워크와 결합해 C++ 기반(멀티스레드) 애플리케이션을 분산 시스템에서 실행하도록 확장하는 것은 매우 손쉬운 일이다.

9장에서 다루는 주제는 다음과 같다.

- 멀티스레드 C++ 애플리케이션에서 OpenMP와 MPI의 통합
- 분산 멀티스레드 애플리케이션의 구현
- 분산 멀티스레드 프로그래밍에서의 일반적인 애플리케이션과 문제점

---

# 분산 컴퓨팅이란


대규모의 데이터를 병렬로 처리할 때 데이터를 소규모로 분할하고 이를 여러 스레드에 할당해 데이터 처리에 소비되는 전체 시간을 상당히 줄일 수 있다면 이상적일 것이다.

분산 컴퓨팅의 개념은 다음과 같다. 즉, 분산 시스템의 각 노드에서 하나 이상의 애플리케이션 인스턴스가 실행한다면 이 애플리케이션은 단일 또는 멀티스레드로 실행 가능하다. 자원 공유 같은 가능한 다른 최적화와 더불어 프로세스 간의 통신 오버헤드로 인해 멀티스레드 애플리케이션을 사용하는 것이 일반적으로 더 효율적이다.

이미 멀티스레드 애플리케이션을 사용할 준비가 돼 있다면 바로 MPI를 사용해 애플리케이션이 분산 시스템에서 동작하도록 할 수 있다. 그렇지 않다면 OpenMP는 일종의 컴파일러 확장(C/C++와 포트란 용도)이다. 이를 이용해 애플리케이션을 재구성할지 않고서도 나름 쉽게 멀티스레드 가능하게 할 수 있다.

이를 위해 OpenMP는 공통 코드 세그먼트를 표시할 수 있게 하여 이들 코드가 모든 슬레이브(slave) 스레드에서 실행되도록 한다. 마스터(master) 스레드는 동일한 코드 세그먼트를 동시에 처리하는 다수의 슬레이브 스레드를 생성한다. 기본적인 OpenMP 애플리케이션의 헬로 월드 비전은 다음과 같다.

``` c++
#include <omp.h>
#include <stdio.h>
#include <stdlib.h>

  

int main (int argc, char *argv[])
{

int nthreads, tid;

/* Fork a team of threads giving them their own copies of variables */
#pragma omp parallel private(nthreads, tid)
  {

  /* Obtain thread number */
  tid = omp_get_thread_num();
  printf("Hello World from thread = %d\n", tid);

  

  /* Only master thread does this */
  if (tid == 0)

    {
    nthreads = omp_get_num_threads();
    printf("Number of threads = %d\n", nthreads);
    }

  

  }  /* All threads join master thread and disband */

  

}
```

이 간단한 예제에서 OpenMP는 `<omp.h>` 헤더를 통해 C 기반의 API를 제공한다는 사실을 알 수 있다. 또한 `#pragma omp` 전처리기 매크로에 의해 표시된 섹션이 각각의 스레드에 의해 실행됨을 알 수도 있다.

이전 장들에서 살펴본 멀티스레드 코드 예제에 비해 OpenMP가 가지는 장점은 실제 코드를 변경하지 않고서도 멀티스레드가 될 수 있는 코드 섹션을 표시할 수 있다는 용이성이다. 이에 대한 분명한 제약은 모든 스레드 인스턴스가 동일한 코드를 실행하고 추가적인 최적화가 제한된다는 것이다.


### MPI

(이 부분은 현재 그렇게 중요하지 않으므로 넘기겠다.)